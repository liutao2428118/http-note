# 国际化

## HTTP 对国际性内容的支持

为了支持国际性的内容，服务器需要告知客户端每个文档的字母表和语言，这样客户端才能正确的把文档中的信息解包为字符并把内容呈现给用户。

服务器通过 HTTP 协议的 Content-Type 首部中的 charset 参数和 Content-Language 首部告知客户端文档字母表和语言。

```js
Accept-Language: fr, en;q=0.8
Accpet-Charset: ios-8859-1, utf-8
```

## 字符集与 HTTP 

### 字符集是把字符转换为二进制的编码

HTTP 字符集的值说明如何把实体内容的二进制码转换为特定字母表中的字符。

下面的 Content-Type 首部告知接受者，传输的内容是一份 HTML 文件，用 charset 参数告知接受者使用 iso-8859-6 阿拉伯字符集的解码算法把内容中的二进制码转换为字符：

```js
Content-Type: text/html; charset=iso-8859-6
```

### 字符集和编码如何工作

把二进制码转换为字符要经过两个步骤：

1. 文档中的二进制码被转换成字符代码，它表示了特定编码字符集中某个特定编号的字符。
2. 字符代码用从编码的字符集中选择特定的元素。

![Image text](/images/1648469683(1).png)

### 字符集不对，字符就不对

如果客户端使用了错误的字符集参数，客户端就会显示一些奇怪的错乱字符。

### Accept-Charset 首部

HTTP 客户端可以使用 Accept-Charset 请求首部来明确告知服务器他支持哪些字符系统。

## 多语言字符编码入门

### 字符集术语

1. 字符，字符是指字母、数字、标点。表意文字、符号，或者其他文本形式书写“原子”。
2. 字形，描述字符的笔画图案或唯一的图形化形状。
3. 编码后的字符，分配给字符的唯一数字编号。
4. 代码空间，计划用于字符代码值得整数范围。
5. 代码宽度，每个（固定大小的）字符代码所用的位数。
6. 字符库，特定的工作字符集（全体字符的一个子集）。
7. 编码后的字符集，组成字符库的已编码字符集，并为每个字符分【配代码空间中的一个代码。
8. 字符编码方案，把数字化的字符代码编码成一系列二进制码的算法。

### 字符

字符就是书写的最基本的构建单元。字符可以表示字母、数字、标点、表意符号、数字符号。在很多书写面语体系中，根据一个字符子单词中的位置的不同，同一个字符也会有不同的笔画形状。

### 编码后的字符集

编码后的字符集把整数映射到字符。编码后的字符经常应数组来实现。

![Image text](/images/1648470756(1).png)

### 字符编码方案

字符编码方案规定如何把字符的代码数字打包装入内容比特。

1. 固定宽度，固定宽度方式的编码有固定数量的比特表示每个编码后的字符。
2. 可变宽度（无模态），可变宽度方式的编码对不同的字符代码数字采用不同数量的比特。
3. 可变看度（有模态），有模态的编码使用特殊的“转义”模式在不同的模态之间切换。

* 8位

8 位固定宽度恒等编码把每个字符码编码为相应的 8 位二进制值。它只能支持有 256 个字符代码范围的字符集。

* UTF-8

UTF-8 的字符代码值使用的是无模态的变宽编码。第一字节的高位表示编码后的字符所用的字节数，所需的每个后续字节都含有 6 位的代码值。

![Image text](/images/1648471655(1).png)

## 语言标记与 HTTP

### Content-Language 首部

 Content-Language 首部不仅限于文本文档、音频片段、电影以及应用程序都有可能是面向特定语言受众。

### Accept-Language 首部

Accept-Language 请求头允许客户端声明它可以理解的自然语言，以及优先选择的区域方言。借助内容协商机制，服务器可以从诸多备选项中选择一项进行应用， 并使用 Content-Language 应答头通知客户端它的选择。

### 子标记

语言标记有一个或多个部分，用连字号分隔，称为子标记：

1. 第一个子标记称为主子标记，其值是标准化的；
2. 第二个子标记是可选的，遵循它自己的命名标准；
3. 其他尾随的子标记都是未注册的。

主子标记只能含有字母。其后的子标记可以拥有字母和数字，长度最多 8 个字符。

sgn-US-MA

所有的标记都不区分大小写。但习惯上用大写字母表示国家，小写表示语言。

第一个和第二个语言子标记的值由各种标准文档以及相关的维护组织定义。

### 第一个子标记——名字空间

第一个子标记通常是标准化的语言记号，选自 ISO 639 中的语言标准集合。也可以用字母 i 来标识在 IANA 中注册的名字，或用 x 表示私有的或者扩展的名字。

![Image text](/images/1648472505(1).png)

### 第二个子标记——名字空间

第二个子标记通常是标准化的国家记号，选自 ISO 3166 中的国家代码和地区标准集合。不过也可以是在 IANA 注册过的其他字符串。

![Image text](/images/1648472578(1).png)

## 国际化的 URI

### 转义和反转义

URI 转义提供了一种安全的方式，可以在 URI 内部插入保留字符以及原来不支持的字符（比如空白）。每个转义是一组 3 字符序列，由百分号 % 后面跟上两个十六进制数字的字符。

例如插入一个空白可以使用 %20（ASCII 32），如果想插入一个百分号并且不想被转义，就可以输入 %25，百分号的十六进制值是 25。
